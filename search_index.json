[["sql.html", "5 SQL", " 5 SQL # Load required libraries library(tidyr) library(dplyr) library(stringr) library(DBI) library(RPostgres) library(readr) library(dslabs) library(ggplot2) # Load in data flu_data &lt;- read_csv(&quot;~/Rachelle/flu_data.csv&quot;, skip = 11) dengue_data &lt;- read_csv(&quot;~/Rachelle/dengue_data.csv&quot;, skip = 11) gapminder_data &lt;- gapminder # Make data tidy flu_tidy &lt;- pivot_longer(data = flu_data, cols = c(2:30), names_to = &quot;Country&quot;, values_to = &quot;Value&quot;) flu_tidy &lt;- flu_tidy %&gt;% mutate(year = str_sub(Date, 1, 4)) %&gt;% select(-Date) dengue_tidy &lt;- pivot_longer(data = dengue_data, cols = c(2:11), names_to = &quot;Country&quot;, values_to = &quot;Value&quot;) dengue_tidy &lt;- dengue_tidy %&gt;% mutate(year = str_sub(Date, 1, 4)) %&gt;% select(-Date) gapminder_data &lt;- as_tibble(gapminder_data) gapminder_data &lt;- gapminder_data %&gt;% rename(Year = year, Country = country) %&gt;% mutate(Year = as.character(Year)) # Convert Year to character # Save dataframes write.csv(flu_tidy, &quot;flu_tidy.csv&quot;) write.csv(dengue_tidy, &quot;dengue_tidy.csv&quot;) write.csv(gapminder_data, &quot;gapminder_tidy.csv&quot;) saveRDS(flu_tidy, &quot;flu_tidy.rds&quot;) saveRDS(dengue_tidy, &quot;dengue_tidy.rds&quot;) saveRDS(gapminder_data, &quot;gapminder_tidy.rds&quot;) # Connect to database in PostgreSQL con &lt;- dbConnect(RPostgres::Postgres(), dbname = &quot;workflowsdb&quot;, host=&quot;localhost&quot;, port=&quot;5432&quot;, user=&quot;postgres&quot;, password=&quot;password&quot;) dbWriteTable(con, &quot;gapminder&quot;, gapminder_data) dbWriteTable(con, &quot;flu&quot;, flu_tidy) dbWriteTable(con, &quot;dengue&quot;, dengue_tidy) # Inspect contents of the tables knitr::include_graphics(&quot;C:\\\\Users\\\\rache\\\\OneDrive\\\\Documenten\\\\Schermafbeelding 2024-08-18 230338.png&quot;) knitr::include_graphics(&quot;C:\\\\Users\\\\rache\\\\OneDrive\\\\Documenten\\\\Schermafbeelding 2024-08-18 230429.png&quot;) knitr::include_graphics(&quot;C:\\\\Users\\\\rache\\\\OneDrive\\\\Documenten\\\\Schermafbeelding 2024-08-18 230509.png&quot;) # Join the tables together flu_tidy &lt;- flu_tidy %&gt;% mutate(year = as.character(year)) dengue_tidy &lt;- dengue_tidy %&gt;% mutate(year = as.character(year)) flu_dengue &lt;- full_join(flu_tidy, dengue_tidy, by = c(&quot;Country&quot;, &quot;year&quot;), suffix = c(&quot;_flu&quot;, &quot;_dengue&quot;)) # Rename &#39;year&#39; to &#39;Year&#39; in flu_dengue for consistency with gapminder_data flu_dengue &lt;- flu_dengue %&gt;% rename(Year = year) # Join with gapminder flu_dengue_gapminder &lt;- inner_join(flu_dengue, gapminder_data, by = c(&quot;Country&quot;, &quot;Year&quot;)) # Check the resulting dataframe print(flu_dengue_gapminder) ## # A tibble: 155,161 × 11 ## Country Value_flu Year Value_dengue infant_mortality life_expectancy ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Argentina NA 2002 NA 17.1 74.3 ## 2 Australia NA 2002 NA 5 80.3 ## 3 Austria NA 2002 NA 4.4 78.8 ## 4 Belgium NA 2002 NA 4.4 78.2 ## 5 Bolivia NA 2002 0.101 53.7 68.7 ## 6 Brazil 174 2002 0.073 24.3 71.4 ## 7 Bulgaria NA 2002 NA 16.3 72.1 ## 8 Canada NA 2002 NA 5.3 79.6 ## 9 Chile NA 2002 NA 8.3 77.7 ## 10 France NA 2002 NA 4.2 79.4 ## # ℹ 155,151 more rows ## # ℹ 5 more variables: fertility &lt;dbl&gt;, population &lt;dbl&gt;, gdp &lt;dbl&gt;, ## # continent &lt;fct&gt;, region &lt;fct&gt; # Boxplot dengue cases per year in Brazil dengue_Brazil &lt;- flu_dengue_gapminder %&gt;% select(Year, Country, Value_dengue) %&gt;% filter(Country == &quot;Brazil&quot;, !is.na(Value_dengue)) dengue_sum &lt;- dengue_Brazil %&gt;% group_by(Year) %&gt;% summarise(mean = mean(Value_dengue, na.rm = TRUE), stedv = sd(Value_dengue, na.rm= TRUE)) # Barchart of dengue cases per year dengue_plot &lt;- ggplot(dengue_sum, aes(x = as.factor(Year), y = mean)) + geom_col(fill = &quot;lightpink&quot;, color = &quot;grey&quot;) + labs(title = &quot;Dengue cases Brazil (in years)&quot;, x = &quot;Year&quot;, y = &quot;Average cases of dengue&quot;) + theme_minimal() dengue_plot "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
